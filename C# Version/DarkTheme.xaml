<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <!-- ── Colors ─────────────────────────────────────────────────────────── -->
    <Color x:Key="BgWindowColor">#F51E1E1E</Color>
    <Color x:Key="BgCardColor">#FF2B2B2B</Color>
    <Color x:Key="BgCardFavColor">#FF332B00</Color>
    <Color x:Key="BgCardSelColor">#FF1A3A52</Color>
    <Color x:Key="BgInputColor">#FF3A3A3A</Color>
    <Color x:Key="BgBtnColor">#FF3A3A3A</Color>
    <Color x:Key="BgBtnHoverColor">#FF4A4A4A</Color>
    <Color x:Key="BorderColor">#FF444444</Color>
    <Color x:Key="BorderFavColor">#FFFFD700</Color>
    <Color x:Key="BorderSelColor">#FF2196F3</Color>
    <Color x:Key="TextColor">#FFE0E0E0</Color>
    <Color x:Key="TextDimColor">#FF888888</Color>
    <Color x:Key="AccentColor">#FF4CAF50</Color>
    <Color x:Key="AccentHoverColor">#FF388E3C</Color>
    <Color x:Key="DangerColor">#FFD32F2F</Color>
    <Color x:Key="DangerHoverColor">#FFB71C1C</Color>

    <!-- ── Brushes ─────────────────────────────────────────────────────────── -->
    <SolidColorBrush x:Key="BgWindowBrush"  Color="{StaticResource BgWindowColor}"/>
    <SolidColorBrush x:Key="BgCardBrush"    Color="{StaticResource BgCardColor}"/>
    <SolidColorBrush x:Key="BgCardFavBrush" Color="{StaticResource BgCardFavColor}"/>
    <SolidColorBrush x:Key="BgCardSelBrush" Color="{StaticResource BgCardSelColor}"/>
    <SolidColorBrush x:Key="BgInputBrush"   Color="{StaticResource BgInputColor}"/>
    <SolidColorBrush x:Key="BgBtnBrush"     Color="{StaticResource BgBtnColor}"/>
    <SolidColorBrush x:Key="BgBtnHoverBrush" Color="{StaticResource BgBtnHoverColor}"/>
    <SolidColorBrush x:Key="BorderBrush2"   Color="{StaticResource BorderColor}"/>
    <SolidColorBrush x:Key="BorderFavBrush" Color="{StaticResource BorderFavColor}"/>
    <SolidColorBrush x:Key="BorderSelBrush" Color="{StaticResource BorderSelColor}"/>
    <SolidColorBrush x:Key="TextBrush"      Color="{StaticResource TextColor}"/>
    <SolidColorBrush x:Key="TextDimBrush"   Color="{StaticResource TextDimColor}"/>
    <SolidColorBrush x:Key="AccentBrush"    Color="{StaticResource AccentColor}"/>
    <SolidColorBrush x:Key="AccentHoverBrush" Color="{StaticResource AccentHoverColor}"/>
    <SolidColorBrush x:Key="DangerBrush"    Color="{StaticResource DangerColor}"/>
    <SolidColorBrush x:Key="DangerHoverBrush" Color="{StaticResource DangerHoverColor}"/>

    <!-- ── Base Button ────────────────────────────────────────────────────── -->
    <Style x:Key="DarkButton" TargetType="Button">
        <Setter Property="Background"       Value="{StaticResource BgBtnBrush}"/>
        <Setter Property="Foreground"       Value="White"/>
        <Setter Property="BorderThickness"  Value="0"/>
        <Setter Property="FontFamily"       Value="Segoe UI"/>
        <Setter Property="FontSize"         Value="13"/>
        <Setter Property="Cursor"           Value="Hand"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="bd" Background="{TemplateBinding Background}"
                            CornerRadius="8" Padding="{TemplateBinding Padding}">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="bd" Property="Background" Value="{StaticResource BgBtnHoverBrush}"/>
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="bd" Property="Background" Value="#FF2A2A2A"/>
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter Property="Foreground" Value="{StaticResource TextDimBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ── Icon Button ────────────────────────────────────────────────────── -->
    <Style x:Key="IconButton" TargetType="Button" BasedOn="{StaticResource DarkButton}">
        <Setter Property="FontSize"  Value="14"/>
        <Setter Property="Padding"   Value="0"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="bd" Background="{TemplateBinding Background}"
                            CornerRadius="6"
                            Width="{TemplateBinding Width}"
                            Height="{TemplateBinding Height}">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="bd" Property="Background" Value="{StaticResource BgBtnHoverBrush}"/>
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="bd" Property="Background" Value="#FF2A2A2A"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ── Accent Button ──────────────────────────────────────────────────── -->
    <Style x:Key="AccentButton" TargetType="Button" BasedOn="{StaticResource DarkButton}">
        <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="bd" Background="{TemplateBinding Background}"
                            CornerRadius="8" Padding="{TemplateBinding Padding}">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="bd" Property="Background" Value="{StaticResource AccentHoverBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ── Danger Button ──────────────────────────────────────────────────── -->
    <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource DarkButton}">
        <Setter Property="Background" Value="{StaticResource DangerBrush}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="bd" Background="{TemplateBinding Background}"
                            CornerRadius="8" Padding="{TemplateBinding Padding}">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="bd" Property="Background" Value="{StaticResource DangerHoverBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ── Tab Button Active ──────────────────────────────────────────────── -->
    <Style x:Key="TabButtonActive" TargetType="Button" BasedOn="{StaticResource DarkButton}">
        <Setter Property="Background"  Value="{StaticResource AccentBrush}"/>
        <Setter Property="FontWeight"  Value="Bold"/>
        <Setter Property="Padding"     Value="15,8"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Border Background="{TemplateBinding Background}" CornerRadius="8" Padding="{TemplateBinding Padding}">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ── Tab Button Inactive ────────────────────────────────────────────── -->
    <Style x:Key="TabButtonInactive" TargetType="Button" BasedOn="{StaticResource DarkButton}">
        <Setter Property="Padding" Value="15,8"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="bd" Background="{TemplateBinding Background}" CornerRadius="8" Padding="{TemplateBinding Padding}">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="bd" Property="Background" Value="{StaticResource BgBtnHoverBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ── TextBox ────────────────────────────────────────────────────────── -->
    <Style x:Key="DarkTextBox" TargetType="TextBox">
        <Setter Property="Background"       Value="{StaticResource BgInputBrush}"/>
        <Setter Property="Foreground"       Value="{StaticResource TextBrush}"/>
        <Setter Property="BorderBrush"      Value="{StaticResource BorderBrush2}"/>
        <Setter Property="BorderThickness"  Value="1"/>
        <Setter Property="Padding"          Value="6"/>
        <Setter Property="FontFamily"       Value="Segoe UI"/>
        <Setter Property="FontSize"         Value="12"/>
        <Setter Property="CaretBrush"       Value="White"/>
        <Setter Property="SelectionBrush"   Value="{StaticResource AccentBrush}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="TextBox">
                    <Border x:Name="border"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="6">
                        <ScrollViewer x:Name="PART_ContentHost" Margin="{TemplateBinding Padding}"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsFocused" Value="True">
                            <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ── ComboBox ───────────────────────────────────────────────────────── -->
    <!-- PART_ToggleButton is REQUIRED by WPF for click-to-open to work.     -->
    <!-- Without it the dropdown only responds to keyboard / scroll wheel.   -->
    <Style x:Key="DarkComboBox" TargetType="ComboBox">
        <Setter Property="Background"        Value="{StaticResource BgInputBrush}"/>
        <Setter Property="Foreground"        Value="{StaticResource TextBrush}"/>
        <Setter Property="BorderBrush"       Value="{StaticResource BorderBrush2}"/>
        <Setter Property="BorderThickness"   Value="1"/>
        <Setter Property="Padding"           Value="6,4"/>
        <Setter Property="FontFamily"        Value="Segoe UI"/>
        <Setter Property="FontSize"          Value="12"/>
        <Setter Property="MaxDropDownHeight" Value="220"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ComboBox">
                    <Grid x:Name="templateRoot">

                        <!-- ToggleButton covers the whole control and drives IsDropDownOpen -->
                        <ToggleButton x:Name="PART_ToggleButton"
                                      IsChecked="{Binding IsDropDownOpen,
                                                  RelativeSource={RelativeSource TemplatedParent},
                                                  Mode=TwoWay}"
                                      Focusable="False"
                                      ClickMode="Press"
                                      Background="{TemplateBinding Background}"
                                      BorderBrush="{TemplateBinding BorderBrush}"
                                      BorderThickness="{TemplateBinding BorderThickness}">
                            <ToggleButton.Template>
                                <ControlTemplate TargetType="ToggleButton">
                                    <Border x:Name="bd"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="6">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="24"/>
                                            </Grid.ColumnDefinitions>
                                            <!-- Arrow -->
                                            <Path Grid.Column="1"
                                                  Data="M0,0 L4,4 L8,0"
                                                  Stroke="White"
                                                  StrokeThickness="1.5"
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"
                                                  IsHitTestVisible="False"/>
                                        </Grid>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="bd" Property="Background" Value="{StaticResource BgBtnHoverBrush}"/>
                                        </Trigger>
                                        <Trigger Property="IsChecked" Value="True">
                                            <Setter TargetName="bd" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </ToggleButton.Template>
                        </ToggleButton>

                        <!-- Selected item text sits on top of the ToggleButton, non-interactive -->
                        <ContentPresenter x:Name="PART_ContentSite"
                                          Content="{TemplateBinding SelectionBoxItem}"
                                          ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                          ContentStringFormat="{TemplateBinding SelectionBoxItemStringFormat}"
                                          HorizontalAlignment="Left"
                                          VerticalAlignment="Center"
                                          Margin="{TemplateBinding Padding}"
                                          IsHitTestVisible="False"
                                          SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>

                        <!-- Dropdown popup -->
                        <Popup x:Name="PART_Popup"
                               AllowsTransparency="True"
                               IsOpen="{Binding IsDropDownOpen,
                                        RelativeSource={RelativeSource TemplatedParent}}"
                               Placement="Bottom"
                               PopupAnimation="Fade"
                               Focusable="False">
                            <Border Background="#FF3A3A3A"
                                    BorderBrush="#FF555555"
                                    BorderThickness="1"
                                    CornerRadius="6"
                                    MinWidth="{Binding ActualWidth,
                                               RelativeSource={RelativeSource TemplatedParent}}"
                                    MaxHeight="{TemplateBinding MaxDropDownHeight}"
                                    Margin="0,2,0,0">
                                <ScrollViewer VerticalScrollBarVisibility="Auto"
                                              HorizontalScrollBarVisibility="Disabled">
                                    <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Contained"
                                                    SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                </ScrollViewer>
                            </Border>
                        </Popup>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>

        <Style.Resources>
            <Style TargetType="ComboBoxItem">
                <Setter Property="Foreground"  Value="#FFE0E0E0"/>
                <Setter Property="Background"  Value="Transparent"/>
                <Setter Property="Padding"     Value="10,6"/>
                <Setter Property="FontFamily"  Value="Segoe UI"/>
                <Setter Property="FontSize"    Value="12"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ComboBoxItem">
                            <Border x:Name="bd"
                                    Background="{TemplateBinding Background}"
                                    Padding="{TemplateBinding Padding}"
                                    CornerRadius="4"
                                    Margin="3,1">
                                <ContentPresenter VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsHighlighted" Value="True">
                                    <Setter TargetName="bd" Property="Background" Value="{StaticResource AccentBrush}"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter TargetName="bd" Property="Background" Value="#FF2E7D32"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </Style.Resources>
    </Style>

    <!-- ── CheckBox ───────────────────────────────────────────────────────── -->
    <Style x:Key="DarkCheckBox" TargetType="CheckBox">
        <Setter Property="Foreground" Value="White"/>
        <Setter Property="FontFamily" Value="Segoe UI"/>
        <Setter Property="FontSize"   Value="12"/>
        <Setter Property="Cursor"     Value="Hand"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="CheckBox">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Border x:Name="checkBorder" Width="16" Height="16" CornerRadius="3"
                                BorderBrush="{StaticResource BorderBrush2}" BorderThickness="1"
                                Background="{StaticResource BgInputBrush}">
                            <Path x:Name="checkMark" Data="M2,8 L6,12 L14,4" Stroke="White"
                                  StrokeThickness="2" Visibility="Collapsed" Margin="1"/>
                        </Border>
                        <ContentPresenter Margin="6,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsChecked" Value="True">
                            <Setter TargetName="checkBorder" Property="Background"   Value="{StaticResource AccentBrush}"/>
                            <Setter TargetName="checkBorder" Property="BorderBrush"  Value="{StaticResource AccentBrush}"/>
                            <Setter TargetName="checkMark"   Property="Visibility"   Value="Visible"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ── ContextMenu ────────────────────────────────────────────────────── -->
    <!-- Global style — no x:Key so it applies to every ContextMenu in the app -->
    <Style TargetType="ContextMenu">
        <Setter Property="Background"      Value="#FF2F2F2F"/>
        <Setter Property="BorderBrush"     Value="#FF555555"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="Padding"         Value="4"/>
        <Setter Property="FontFamily"      Value="Segoe UI"/>
        <Setter Property="FontSize"        Value="12"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ContextMenu">
                    <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="8"
                            Padding="{TemplateBinding Padding}">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="12" ShadowDepth="4" Opacity="0.5" Color="Black"/>
                        </Border.Effect>
                        <ItemsPresenter/>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ── MenuItem ───────────────────────────────────────────────────────── -->
    <!-- FIX: Custom template removes the white icon column on the left       -->
    <Style TargetType="MenuItem">
        <Setter Property="Background"      Value="Transparent"/>
        <Setter Property="Foreground"      Value="#FFE0E0E0"/>
        <Setter Property="FontFamily"      Value="Segoe UI"/>
        <Setter Property="FontSize"        Value="12"/>
        <Setter Property="Padding"         Value="12,7"/>
        <Setter Property="Cursor"          Value="Hand"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="MenuItem">
                    <Border x:Name="bd"
                            Background="{TemplateBinding Background}"
                            CornerRadius="5"
                            Margin="2,1"
                            Padding="{TemplateBinding Padding}">
                        <ContentPresenter ContentSource="Header" RecognizesAccessKey="True"
                                          VerticalAlignment="Center"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsHighlighted" Value="True">
                            <Setter TargetName="bd" Property="Background" Value="{StaticResource AccentBrush}"/>
                            <Setter Property="Foreground" Value="White"/>
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter Property="Foreground" Value="#FF666666"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ── Separator (used in ContextMenu) ───────────────────────────────── -->
    <Style TargetType="Separator">
        <Setter Property="Background" Value="#FF484848"/>
        <Setter Property="Height"     Value="1"/>
        <Setter Property="Margin"     Value="8,3"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Separator">
                    <Border Background="{TemplateBinding Background}"
                            Height="{TemplateBinding Height}"
                            Margin="{TemplateBinding Margin}"/>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ── ScrollBar ──────────────────────────────────────────────────────── -->
    <Style TargetType="ScrollBar">
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Width"      Value="6"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ScrollBar">
                    <Grid Background="Transparent">
                        <Track x:Name="PART_Track" IsDirectionReversed="True">
                            <Track.DecreaseRepeatButton>
                                <RepeatButton Command="ScrollBar.LineUpCommand" Opacity="0" Height="0"/>
                            </Track.DecreaseRepeatButton>
                            <Track.Thumb>
                                <Thumb>
                                    <Thumb.Template>
                                        <ControlTemplate TargetType="Thumb">
                                            <Border Background="#FF555555" CornerRadius="3" Margin="1,0"/>
                                        </ControlTemplate>
                                    </Thumb.Template>
                                </Thumb>
                            </Track.Thumb>
                            <Track.IncreaseRepeatButton>
                                <RepeatButton Command="ScrollBar.LineDownCommand" Opacity="0" Height="0"/>
                            </Track.IncreaseRepeatButton>
                        </Track>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>
